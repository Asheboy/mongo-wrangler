#!/usr/bin/env node
!function(e){var n={};function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)o.d(t,r,function(n){return e[n]}.bind(null,r));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="",o(o.s=1)}([function(e,n){e.exports=require("path")},function(e,n,o){e.exports=o(2)},function(e,n,o){var t=o(3).execSync,r=o(4)(process.argv.slice(2),{boolean:["v","n"]}),s=o(5),i=o(0),l=r._[0]||process.env.DATABASE_NAME,a=process.env.URL||r._[1],c=!!r.v,u=!!r.n;function f(e){let n;try{n=t(e).toString()}catch(e){console.error("There was an error. Use `-v` to see the failed output. Often -n to ignore indexes, fixes the issue."),process.exit(1)}return c&&(console.log("$ "+s(e,"dark grey")),console.log(n)),n}l||(console.error(s("Missing database name","red")),console.log(""),console.log("Usage:"),console.log("\t"+i.basename(process.argv[1])+" [options] database url"),console.log("Options:"),console.log("\t-v - verbose"),console.log("\t-n - no indexes"),console.log("\n"),process.exit(1));var p=o(6).parse,d=(0,o(0).basename)(p(a).path),b=d.replace(/\.tar\.bz$/g,""),g=Math.random().toString(36).substr(2),v="/tmp/"+g+"/";console.log(v),console.log("Restoring Database",s(l,"yellow"),"from",s(a,"green")),f("mkdir -p /tmp/"+g),f("curl --silent "+a+" -o "+v+d),f("tar jxvf "+v+d+" -C "+v),f("mongorestore "+(c?"":"--quiet")+" "+(u?"--noIndexRestore":"")+" --drop -d "+l+" "+v+"dump/"+b),f("rm -rf /tmp/"+g)},function(e,n){e.exports=require("child_process")},function(e,n){function o(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}e.exports=function(e,n){n||(n={});var t={bools:{},strings:{},unknownFn:null};"function"==typeof n.unknown&&(t.unknownFn=n.unknown),"boolean"==typeof n.boolean&&n.boolean?t.allBools=!0:[].concat(n.boolean).filter(Boolean).forEach(function(e){t.bools[e]=!0});var r={};Object.keys(n.alias||{}).forEach(function(e){r[e]=[].concat(n.alias[e]),r[e].forEach(function(n){r[n]=[e].concat(r[e].filter(function(e){return n!==e}))})}),[].concat(n.string).filter(Boolean).forEach(function(e){t.strings[e]=!0,r[e]&&(t.strings[r[e]]=!0)});var s=n.default||{},i={_:[]};Object.keys(t.bools).forEach(function(e){a(e,void 0!==s[e]&&s[e])});var l=[];function a(e,n,s){if(!s||!t.unknownFn||function(e,n){return t.allBools&&/^--[^=]+$/.test(n)||t.strings[e]||t.bools[e]||r[e]}(e,s)||!1!==t.unknownFn(s)){var l=!t.strings[e]&&o(n)?Number(n):n;c(i,e.split("."),l),(r[e]||[]).forEach(function(e){c(i,e.split("."),l)})}}function c(e,n,o){var r=e;n.slice(0,-1).forEach(function(e){void 0===r[e]&&(r[e]={}),r=r[e]});var s=n[n.length-1];void 0===r[s]||t.bools[s]||"boolean"==typeof r[s]?r[s]=o:Array.isArray(r[s])?r[s].push(o):r[s]=[r[s],o]}function u(e){return r[e].some(function(e){return t.bools[e]})}-1!==e.indexOf("--")&&(l=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var f=0;f<e.length;f++){var p=e[f];if(/^--.+=/.test(p)){var d=p.match(/^--([^=]+)=([\s\S]*)$/),b=d[1],g=d[2];t.bools[b]&&(g="false"!==g),a(b,g,p)}else if(/^--no-.+/.test(p)){a(b=p.match(/^--no-(.+)/)[1],!1,p)}else if(/^--.+/.test(p)){b=p.match(/^--(.+)/)[1];void 0===(y=e[f+1])||/^-/.test(y)||t.bools[b]||t.allBools||r[b]&&u(b)?/^(true|false)$/.test(y)?(a(b,"true"===y,p),f++):a(b,!t.strings[b]||"",p):(a(b,y,p),f++)}else if(/^-[^-]+/.test(p)){for(var v=p.slice(1,-1).split(""),h=!1,m=0;m<v.length;m++){var y;if("-"!==(y=p.slice(m+2))){if(/[A-Za-z]/.test(v[m])&&/=/.test(y)){a(v[m],y.split("=")[1],p),h=!0;break}if(/[A-Za-z]/.test(v[m])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(y)){a(v[m],y,p),h=!0;break}if(v[m+1]&&v[m+1].match(/\W/)){a(v[m],p.slice(m+2),p),h=!0;break}a(v[m],!t.strings[v[m]]||"",p)}else a(v[m],y,p)}b=p.slice(-1)[0];h||"-"===b||(!e[f+1]||/^(-|--)[^-]/.test(e[f+1])||t.bools[b]||r[b]&&u(b)?e[f+1]&&/true|false/.test(e[f+1])?(a(b,"true"===e[f+1],p),f++):a(b,!t.strings[b]||"",p):(a(b,e[f+1],p),f++))}else if(t.unknownFn&&!1===t.unknownFn(p)||i._.push(t.strings._||!o(p)?p:Number(p)),n.stopEarly){i._.push.apply(i._,e.slice(f+1));break}}return Object.keys(s).forEach(function(e){(function(e,n){var o=e;return n.slice(0,-1).forEach(function(e){o=o[e]||{}}),n[n.length-1]in o})(i,e.split("."))||(c(i,e.split("."),s[e]),(r[e]||[]).forEach(function(n){c(i,n.split("."),s[e])}))}),n["--"]?(i["--"]=new Array,l.forEach(function(e){i["--"].push(e)})):l.forEach(function(e){i._.push(e)}),i}},function(e,n){var o={reset:"[0m",red:"[31m",green:"[32m",grey:"[38;5;245m","dark grey":"[38;5;245m",yellow:"[33;1m",white:"[37;1m"};e.exports=function(e,n){return(o[n]||o.reset)+e+o.reset}},function(e,n){e.exports=require("url")}]);